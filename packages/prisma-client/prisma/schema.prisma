datasource db {
  provider = "postgres"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "cargo prisma"
  output   = "../src/db.rs"
}

model User {
  id       String    @id @default(cuid())
  name     String
  email    String    @unique
  password String
  ships    Ship[]
  flights  Flight[]
  storages Storage[]
}

model Ship {
  id          String @id @default(cuid())
  user_id     String
  user        User   @relation(fields: [user_id], references: [id])
  position_id String
  type        String

  storage_id String  @unique
  storage    Storage @relation(fields: [storage_id], references: [id])

  // flight ShipsInFlight? @relation(fields: [id], references: [ship_id])
  flight ShipsInFlight[]
}

model Flight {
  id      String @id @default(cuid())
  user_id String
  user    User   @relation(fields: [user_id], references: [id])

  from_id String
  to_id   String

  ships ShipsInFlight[]

  arrival_time Int
  return_time  Int?
  mission      String
  speed_ratio  Int
}

model ShipsInFlight {
  ship_id   String  @unique
  flight_id String
  flight    Flight  @relation(fields: [flight_id], references: [id])
  ship      Ship?   @relation(fields: [ship_id], references: [id])

  @@id([ship_id, flight_id])
}

model Storage {
  id           String @id @default(cuid())
  user_id      String
  user         User   @relation(fields: [user_id], references: [id])
  structure_id String

  items String // json

  ship Ship?
}
