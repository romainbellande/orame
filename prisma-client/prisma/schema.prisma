datasource db {
  provider = "postgres"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "cargo prisma"
  output   = "../src/db.rs"
}

model User {
  id       String   @id @default(cuid())
  name     String
  email    String   @unique
  password String
  planets  Planet[]
}

model Planet {
  id      String @id @default(cuid())

  user_id String
  user    User   @relation(fields: [user_id], references: [id])

  coordinates_id String @unique
  coordinates Coordinates @relation(fields: [coordinates_id], references: [id])

  resources_id   String @unique
  resources   Resources  @relation(fields: [resources_id], references: [id])

  buildings   Buildings?

  ships_id     String @unique
  ships       Ships  @relation(fields: [ships_id], references: [id])
  build_queue String
  ship_queue  String
  last_update Int

  out_flights Flight[]     @relation("in_flights")
  in_flights  Flight[]     @relation("out_flights")
}

model Coordinates {
  id        String @id @default(cuid())

  galaxy   Int
  system   Int
  position Int

  planet   Planet?
}

model Resources {
  id        String @id @default(cuid())

  metal     Float
  crystal   Float
  deuterium Float

  planet    Planet? 
  flight    Flight?
}

model Buildings {
  id        String @id @default(cuid())

  metal     Int
  crystal   Int
  deuterium Int
  shipyard  Int

  planet_id String @unique
  planet    Planet @relation(fields: [planet_id], references: [id])
}

model Ships {
  id        String @id @default(cuid())

  smallCargo     Int
  largeCargo     Int
  colonyShip     Int
  recycler       Int
  espionageProbe Int
  solarSatellite Int
  lightFighter   Int
  heavyFighter   Int
  cruiser        Int
  battleship     Int
  bomber         Int
  destroyer      Int
  battlecruiser  Int
  deathstar      Int
  flight         Flight?
  planet         Planet?
}

model Flight {
  id             String    @id @default(cuid())
  player_id      String
  from_planet_id String
  from_planet    Planet    @relation("in_flights", fields: [from_planet_id], references: [id])
  to_planet_id   String
  to_planet      Planet    @relation("out_flights", fields: [to_planet_id], references: [id])
  ships_id       String    @unique
  ships          Ships     @relation(fields: [ships_id], references: [id])
  resources_id   String    @unique
  resources      Resources @relation(fields: [resources_id], references: [id])

  arrival_time Int
  return_time  Int?
  mission      String
  speed_ratio  Int
}
